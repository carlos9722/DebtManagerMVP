<div class="bg-base-200 py-6 px-4 sm:px-6 lg:px-8">
  <!-- Navegación y título -->
  <div class="mb-8">
    <a routerLink="/debt/debtors" class="btn btn-ghost btn-sm gap-2 mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Volver a Deudores
    </a>

    <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <h1 class="text-3xl font-bold text-slate-800 sm:text-4xl">
          Deudas de {{ debtor()?.name || 'Cargando...' }}
        </h1>
        @if (debtor()) {
          <div class="mt-2 flex flex-wrap gap-4 text-sm text-slate-600">
            @if (debtor()?.email) {
              <span class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
                {{ debtor()?.email }}
              </span>
            }
            @if (debtor()?.phone) {
              <span class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
                {{ debtor()?.phone }}
              </span>
            }
          </div>
        }
      </div>
      
      <button
        class="btn btn-secondary gap-2 transition-all duration-200 hover:shadow-lg active:scale-[0.98]"
        (click)="openCreateForm()"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Nueva Deuda
      </button>
    </div>
  </div>

  <!-- Filtros y Tabla de deudas -->
  <div class="card bg-white border border-base-300 shadow-lg">
    <div class="card-body">
      <!-- Filtros -->
      <div class="flex flex-wrap gap-2 mb-4">
        <button
          class="btn btn-sm"
          [class.btn-primary]="filter() === 'all'"
          [class.btn-ghost]="filter() !== 'all'"
          (click)="setFilter('all')"
        >
          Todas
          <span class="badge badge-sm ml-1">{{ (debtor()?.debts || []).length }}</span>
        </button>
        <button
          class="btn btn-sm"
          [class.btn-warning]="filter() === 'pending'"
          [class.btn-ghost]="filter() !== 'pending'"
          (click)="setFilter('pending')"
        >
          Pendientes
          <span class="badge badge-sm ml-1">{{ pendingCount() }}</span>
        </button>
        <button
          class="btn btn-sm"
          [class.btn-success]="filter() === 'paid'"
          [class.btn-ghost]="filter() !== 'paid'"
          (click)="setFilter('paid')"
        >
          Pagadas
          <span class="badge badge-sm ml-1">{{ paidCount() }}</span>
        </button>
      </div>

      <app-debts-table
        [debts]="filteredDebts()"
        [isLoading]="isLoading()"
        (onEdit)="handleEdit($event)"
        (onDelete)="handleDelete($event)"
        (onPay)="handlePay($event)"
      ></app-debts-table>
    </div>
  </div>
</div>

<!-- Modal de Formulario -->
@if (showForm()) {
  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md animate-fadeIn">
      <div class="p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-bold text-slate-800">
            {{ editingDebt() ? 'Editar Deuda' : 'Nueva Deuda' }}
          </h2>
          <button
            class="btn btn-ghost btn-sm btn-circle"
            (click)="handleFormCancel()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <app-debt-form
          [debt]="editingDebt()"
          (onSubmit)="handleFormSubmit($event)"
          (onCancel)="handleFormCancel()"
        ></app-debt-form>
      </div>
    </div>
  </div>
}

<!-- Alerta de error -->
@if(errorMessage()) {
  <div
    role="alert"
    class="alert alert-error fixed bottom-4 left-1/2 w-[calc(100%-2rem)] max-w-xs -translate-x-1/2 animate-fadeIn shadow-xl sm:left-auto sm:right-5 sm:w-72 sm:max-w-none sm:translate-x-0"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <span class="text-xs sm:text-sm">{{ errorMessage() }}</span>
  </div>
}

<!-- Alerta de éxito -->
@if(successMessage()) {
  <div
    role="alert"
    class="alert alert-success fixed bottom-4 left-1/2 w-[calc(100%-2rem)] max-w-xs -translate-x-1/2 animate-fadeIn shadow-xl sm:left-auto sm:right-5 sm:w-72 sm:max-w-none sm:translate-x-0"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <span class="text-xs sm:text-sm">{{ successMessage() }}</span>
  </div>
}

<!-- Diálogo de confirmación de eliminación -->
<app-confirm-dialog
  [isOpen]="showDeleteDialog()"
  title="Eliminar Deuda"
  [message]="'¿Estás seguro de eliminar la deuda: ' + (debtToDelete()?.description || '') + '?'"
  confirmText="Eliminar"
  cancelText="Cancelar"
  confirmButtonClass="btn-error"
  (onConfirm)="confirmDelete()"
  (onCancel)="cancelDelete()">
</app-confirm-dialog>

<!-- Diálogo de confirmación de pago -->
<app-confirm-dialog
  [isOpen]="showPayDialog()"
  title="Marcar como Pagada"
  [message]="'¿Confirma que la deuda ha sido pagada?'"
  confirmText="Confirmar Pago"
  cancelText="Cancelar"
  confirmButtonClass="btn-success"
  (onConfirm)="confirmPay()"
  (onCancel)="cancelPay()">
</app-confirm-dialog>
